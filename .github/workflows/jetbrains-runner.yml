name: JetBrains Runner

on:
  workflow_dispatch:
    inputs:
      runs-on:
        description: 'Runner System Type'
        type: string
        required: false
        default: 'ubuntu-22.04'
      free-space:
        description: 'Free Disk Space'
        type: boolean
        required: false
        default: false
      script:
        description: 'Base64 Encoded Script'
        type: string
        required: true
      gzip:
        description: 'Is Gzipped (Implies Base64+Gzip)'
        type: boolean
        required: false
        default: false

jobs:
  remote-execution:
    runs-on: ${{ inputs.runs-on }}
    steps:
      - name: Free Disk Space
        if: ${{ inputs.free-space }}
        uses: jlumbroso/free-disk-space@main
        with:
          tool-cache: false
          android: true
          dotnet: true
          haskell: true
          large-packages: true
          docker-images: true
          swap-storage: true

      - name: Execute Script
        run: |
          # ðŸš€ Runner for GitHub Actions
          
          # 1. Save input to file
          printf '%s' "${{ inputs.script }}" > input_b64
          
          # 2. Decode Base64 (Always required to preserve newlines/formatting)
          base64 -d input_b64 > decoded_raw
          
          # 3. Decompress Gzip if enabled
          if [ "${{ inputs.gzip }}" == "true" ]; then
            gunzip < decoded_raw > script.sh
          else
            mv decoded_raw script.sh
          fi

          # 4. Execute
          chmod +x script.sh
          ./script.sh
