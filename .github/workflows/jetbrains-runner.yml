name: JetBrains Runner

on:
  workflow_dispatch:
    inputs:
      runs-on:
        description: 'Runner System Type'
        type: string
        required: false
        default: 'ubuntu-22.04'
      free-space:
        description: 'Free Disk Space'
        type: boolean
        required: false
        default: false
      script:
        description: 'Script Content'
        type: string
        required: true
      gzip:
        description: 'Is Base64 encoded Gzip content'
        type: boolean
        required: false
        default: false

jobs:
  remote-execution:
    runs-on: ${{ inputs.runs-on }}
    steps:
      - name: Free Disk Space
        if: ${{ inputs.free-space }}
        uses: jlumbroso/free-disk-space@main
        with:
          tool-cache: false
          android: true
          dotnet: true
          haskell: true
          large-packages: true
          docker-images: true
          swap-storage: true

      - name: Execute Script
        run: |
          # ðŸš€ Runner for GitHub Actions
          
          # 1. Save input to file
          printf '%s' "${{ inputs.script }}" > raw_script
          
          # 2. Process Script
          # If gzip is enabled, it MUST be Base64 encoded to survive transport.
          if [ "${{ inputs.gzip }}" == "true" ]; then
            base64 -d raw_script | gunzip > script.sh
          else
            mv raw_script script.sh
          fi

          # 3. Execute
          chmod +x script.sh
          ./script.sh
